@model WebBanMayTinh.Models.Order

@{
    ViewData["Title"] = "Details";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";

    decimal subTotal = 0;
    foreach (var i in Model.OrderItems)
    {
        subTotal = subTotal + i.Price * i.Quantity; 
    }
}

<h2 class="text-center">Chi tiết sản phẩm</h2>

<div>
    <hr />
    <div class="card">
        <div class="card-body">
            <dl class="row">
                <dt class="col-sm-2">
                    @Html.DisplayNameFor(model => model.CreatedAt)
                </dt>
                <dd class="col-sm-10">
                    @Html.DisplayFor(model => model.CreatedAt)
                </dd>
                <dt class="col-sm-2">
                    @Html.DisplayNameFor(model => model.UpdatedAt)
                </dt>
                <dd class="col-sm-10">
                    @Html.DisplayFor(model => model.UpdatedAt)
                </dd>
                <hr />

                <dt class="col-sm-2">
                    @Html.DisplayNameFor(model => model.Status)
                </dt>
                <dd class="col-sm-10 @OrderStatusExtensions.ToTextColor(Model.Status)">
                    @OrderStatusExtensions.ToVietNamText(Model.Status)
                </dd>

                @if (Model.Status == OrderStatus.Cancelled && Model.CancelledAt is not null)
                {
                    <dt class="col-sm-2">
                        @Html.DisplayNameFor(model => model.CancelRequestedAt)
                    </dt>
                    <dd class="col-sm-10">
                        @Html.DisplayFor(model => model.CancelRequestedAt)
                    </dd>

                    <dt class="col-sm-2">
                        @Html.DisplayNameFor(model => model.CancelReason)
                    </dt>
                    <dd class="col-sm-10">
                        @Html.DisplayFor(model => model.CancelReason)
                    </dd>

                    <dt class="col-sm-2">
                        @Html.DisplayNameFor(model => model.CancelledAt)
                    </dt>
                    <dd class="col-sm-10">
                        @Html.DisplayFor(model => model.CancelledAt)
                    </dd>
                    
                }

                <hr />
                <dt class="col-sm-2">
                    @Html.DisplayNameFor(model => model.Subtotal)
                    @* @CurrencyExtensions.ToVnd(Model.Subtotal) *@
                </dt>
                <dd class="col-sm-10">
                    @CurrencyExtensions.ToVnd(subTotal)

                    @* @Html.DisplayFor(model => model.Subtotal) *@
                </dd>
                <dt class="col-sm-2">
                    @Html.DisplayNameFor(model => model.ShippingFee)
                </dt>
                <dd class="col-sm-10">
                    @* @Html.DisplayFor(model => model.ShippingFee) *@
                    @CurrencyExtensions.ToVnd(Model.ShippingFee)
                </dd>
                <dt class="col-sm-2">
                    @Html.DisplayNameFor(model => model.TotalAmount)
                </dt>
                <dd class="col-sm-10">
                    @* @Html.DisplayFor(model => model.TotalAmount) *@
                    @CurrencyExtensions.ToVnd(subTotal + Model.ShippingFee)
                </dd>
                <dt class="col-sm-2">
                    @Html.DisplayNameFor(model => model.User)
                </dt>
                <dd class="col-sm-10">
                    @Html.DisplayFor(model => model.User.UserName)
                </dd>
                <dt class="col-sm-2">
                    Người nhận
                </dt>
                <dd class="col-sm-10">
                    @(Model.Address.ReceiverName + " (" + Model.Address.Phone))
                </dd>
                <dt class="col-sm-2">
                    @Html.DisplayNameFor(model => model.Address)
                </dt>
                <dd class="col-sm-10">
                    @(Model.Address.GetAddressDetail())
                </dd>
            </dl>

        </div>
    </div>
    <hr />
    <h2 class="text-center">Thông tin sản phẩm</h2>
    <div class="card">
        <div class="card-body">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Tên sản phẩm</th>
                        <th scope="col">Số lượng</th>
                        <th scope="col">Đơn giá</th>
                        <th scope="col">Tổng tiền</th>
                    </tr>
                </thead>
                <tbody>
                    @for (int i = 0; i < Model.OrderItems.Count(); i++)
                    {
                        <tr>
                            <th scope="row">@(i + 1)</th>
                            <td>@Model.OrderItems[i].Product.Name</td>
                            <td>@Model.OrderItems[i].Quantity</td>
                            <td>@CurrencyExtensions.ToVnd(@Model.OrderItems[i].Price)</td>
                            <td>@CurrencyExtensions.ToVnd(Model.OrderItems[i].Quantity * Model.OrderItems[i].Price)</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>    
    </div>

</div>
<div class="d-flex justify-content-end mt-4 gap-2">
    <a asp-action="Index" class="btn btn-danger">Quay lại</a>
    <a asp-action="Edit" asp-route-id="@Model?.Id" class="btn btn-primary">Sửa</a>
</div>
